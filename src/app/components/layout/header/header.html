<nav class="navbar navbar-expand-lg navbar-light bg-light border-0 shadow-sm">
  <div class="container-fluid py-2 pe-md-5 ">
    <!-- Brand - Mobile Only -->
    <!-- <a class="navbar-brand fw-bold d-sm-none d-lg-none" href="#">
      <i class="bi bi-mortarboard-fill me-2"></i>
      EduSkill
    </a> -->

    <!-- Desktop sidebar toggle -->
    <button class="btn btn-outline-secondary me-2 d-none d-lg-block border-0" type="button"
      (click)="toggleSidebarCollapse()">
      <lucide-icon [img]="Menu" [size]="20"></lucide-icon>
    </button>

    <!-- Mobile menu toggle -->
    <button class="btn btn-outline-secondary d-lg-none me-2 border-0" type="button" (click)="toggleSidebar()">
      <lucide-icon [img]="Menu" [size]="20"></lucide-icon>
    </button>


    <!-- Right side items -->
    <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
      <!-- Right Panel Toggle (Desktop only) -->
      <button *ngIf="isAuthenticated" class="btn btn-outline-secondary me-2 d-none d-lg-block border-0"
        (click)="toggleRightPanel()" title="Toggle Right Panel">
        <i class="bi bi-layout-sidebar-inset-reverse"></i>
      </button>

      <!-- Theme toggle -->
      <button class="btn btn-outline-secondary me-2 border-0" (click)="toggleTheme()"
        [title]="isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
        <i class="bi" [ngClass]="isDarkMode ? 'bi-sun-fill' : 'bi-moon-fill'"></i>
      </button>

      <button *ngIf="!isAuthenticated" (click)="navigateToRegister()"
        class="btn btn-outline-secondary me-2 d-none d-lg-block border-0 fw-semibold" title="register">
        <span>Register</span>
      </button>
      <button *ngIf="!isAuthenticated" (click)="navigateToLogin()"
        class="btn btn-outline-secondary me-2 d-none d-lg-block border-0 fw-semibold" title="login">
        <span>Login</span>
      </button>

      <!-- Notifications -->
      <div *ngIf="isAuthenticated" class="dropdown me-4" [class.show]="showNotificationDropdown">
        <button class="btn btn-outline-secondary position-relative py-1 px-2" type="button"
          (click)="toggleNotificationDropdown($event)">
          <i class="bi bi-bell-fill"></i>
          <span *ngIf="unreadCount > 0" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            {{ unreadCount }}
          </span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end rounded-4 mt-3 border-0 shadow-lg" style="min-width: 280px; max-width: 300px; max-height: 400px; overflow-y: auto; overflow-x: hidden;" [class.show]="showNotificationDropdown">
          <li>
            <div class="d-flex justify-content-between align-items-center px-3 py-2 border-bottom">
              <h6 class="dropdown-header mb-0">Notifications</h6>
              <span *ngIf="unreadCount > 0" class="badge bg-primary">{{ unreadCount }} new</span>
            </div>
          </li>
          <li *ngIf="notifications.length === 0">
            <div class="dropdown-item text-center py-4">
              <i class="bi bi-bell-slash fs-4 text-body-secondary opacity-50"></i>
              <p class="text-body-secondary small mb-0 mt-2">No notifications</p>
            </div>
          </li>
          <li *ngFor="let notification of notifications">
            <a class="dropdown-item py-3" 
               [class.bg-body-tertiary]="!notification.read"
               (click)="markAsRead(notification, $event)">
              <div class="d-flex align-items-start gap-2">
                <div class="flex-shrink-0">
                  <i class="bi" [ngClass]="getTypeIcon(notification.type)" [class.text-primary]="notification.type === 'course'" [class.text-warning]="notification.type === 'assignment'" [class.text-success]="notification.type === 'job'" [class.text-info]="notification.type === 'booking'"></i>
                </div>
                <div class="flex-grow-1" style="min-width: 0;">
                  <div class="d-flex justify-content-between align-items-start mb-1 gap-2">
                    <h6 class="mb-0 small fw-semibold text-body" [class.fw-normal]="notification.read" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1;">{{ notification.title }}</h6>
                    <span *ngIf="!notification.read" class="badge bg-primary rounded-circle flex-shrink-0" style="width: 6px; height: 6px; margin-top: 4px;"></span>
                  </div>
                  <p class="text-body-secondary extra-small mb-1" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; word-break: break-word;">
                    {{ notification.message }}
                  </p>
                  <span class="text-body-secondary extra-small">{{ getTimeAgo(notification.createdAt) }}</span>
                </div>
              </div>
            </a>
          </li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li>
            <a class="dropdown-item text-center fw-semibold" (click)="navigateToNotifications()">
              <i class="bi bi-arrow-right me-2"></i>View all notifications
            </a>
          </li>
        </ul>
      </div>

      <!-- User profile -->
      <div *ngIf="isAuthenticated" class="dropdown" [class.show]="showUserDropdown">
        <a class="d-flex align-items-center border-0" type="button" (click)="toggleUserDropdown($event)">
          <!-- <i class="bi bi-person-circle me-1"></i>
          {{ currentUser?.username || 'User' }} -->
          <div class="position-relative">
            <div
              class="avatar-initial bg-light text-dark rounded-circle me-1 d-flex align-items-center justify-content-center fw-semibold"
              style="width: 30px; height: 30px; min-width: 30px;">
              <img src="{{placeholdername()}}" alt="">
            </div>
            <span class="position-absolute bottom-1 end-0 translate-middle-y badge rounded-pill bg-success p-1" 
                  style="width: 10px; height: 10px; border: 2px solid white;">
              <span class="visually-hidden">Online</span>
            </span>
          </div>
        </a>
        <ul class="dropdown-menu dropdown-menu-end rounded-4 mt-3 border-0" [class.show]="showUserDropdown">
          <div class="d-flex flex-row gap-2 align-items-center p-2 pe-3">
            <div class="d-flex" style="width: 30px; height: 30px; min-width: 30px;">
              <img src="{{placeholdername()}}" alt="">
            </div>
            <div class="flex-grow-1" style="min-width: 0;">
              <h6 class="m-0 p-0 text-truncate">{{fullname}}</h6>
              <p class="p-0 m-0 text-primary small text-truncate" style="text-transform: capitalize !important;">{{accountType}}</p>
            </div>
            
          </div>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" routerLink="/account/profile" routerLinkActive="active" (click)="closeDropdowns()"><i class="bi bi-person-fill me-2"></i>Profile</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><button class="dropdown-item" (click)="logout()"><i class="bi bi-box-arrow-right me-2"></i>Logout</button>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>