<div class="academics-container p-0 min-vh-100">
    <!-- Header Section -->
    <app-page-header title="Skills" description="Manage and track your skills and expertise"
        actionButtonText="Add Skill" actionButtonIcon="bi bi-plus-circle" (actionButtonClick)="openAddModal()">
    </app-page-header>

    <!-- Skills Section -->
    <div class="skills-section mb-5 px-3 px-md-4">

        <!-- Filter Bar -->
        <div class="filter-bar d-flex flex-column flex-lg-row align-items-lg-end justify-content-between gap-3 gap-lg-4 mb-4">
            <div class="filters-left d-flex flex-column flex-md-row gap-3 gap-lg-4 w-100 w-lg-auto">
                <!-- Proficiency Level Filter -->
                <div class="filter-group flex-fill">
                    <label class="filter-label mb-2">
                         Proficiency Level
                    </label>
                    <app-account-type-selector [accountTypes]="proficiencyOptions" [(ngModel)]="selectedProficiency"
                        (ngModelChange)="onProficiencyChange()" [label]="''" [placeholder]="'All Levels'"
                        id="proficiencyFilter">
                    </app-account-type-selector>
                </div>

                <!-- Sort Filter -->
                <div class="filter-group flex-fill">
                    <label class="filter-label mb-2">
                        Sort By
                    </label>
                    <app-account-type-selector [accountTypes]="sortOptions" [(ngModel)]="selectedSort"
                        (ngModelChange)="onSearch()" [label]="''" [placeholder]="'Newest First'" id="sortFilter">
                    </app-account-type-selector>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div class="text-center py-5" *ngIf="isLoading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted">Loading your skills...</p>
        </div>

        <!-- Empty State -->
        <div class="empty-state text-center py-5" *ngIf="!isLoading && filteredSkills.length === 0">
            <i class="bi bi-inbox display-1 text-muted"></i>
            <h3 class="mt-3">No Skills Found</h3>
            <p class="text-muted">{{ skills.length === 0 ? 'Start by adding your first skill!' : 'Try adjusting your filters' }}</p>
        </div>

        <!-- Skills Grid -->
        <div class="skills-grid" *ngIf="!isLoading && filteredSkills.length > 0">
            <div class="skill-card bg-body rounded-3 overflow-hidden cursor-pointer d-flex flex-column" *ngFor="let skill of filteredSkills">
                <div class="skill-thumbnail-container bg-secondary flex-shrink-0">
                    <img [src]="skill.thumbnailUrl || 'assets/images/skill-placeholder.jpg'" 
                         [alt]="skill.skillName"
                         appImageError>
                    <span class="proficiency-badge badge rounded-pill d-flex align-items-center gap-1 fw-semibold small" 
                          [ngClass]="skill.proficiencyClass">
                        <i [class]="skill.proficiencyIcon"></i>
                        {{ skill.proficiencyLevel }}
                    </span>
                </div>
                <div class="p-3 bg-body flex-fill d-flex flex-column">
                    <div class="d-flex gap-3 align-items-start">
                        <div class="skill-icon rounded-circle d-flex align-items-center justify-content-center flex-shrink-0 border-2" 
                             [ngClass]="skill.proficiencyClass">
                            <i [class]="skill.proficiencyIcon"></i>
                        </div>
                        <div class="flex-fill" style="min-width: 0;">
                            <h3 class="card-title fw-semibold text-body mb-1 lh-sm small">{{ skill.skillName }}</h3>
                            <p class="text-secondary mb-1 fw-medium small" style="font-size: 0.85rem;">{{ skill.category }}</p>
                            <div class="d-flex align-items-center gap-2 flex-wrap text-muted" style="font-size: 0.8rem;">
                                <span>{{ skill.createdAt | date:'MMM d, y' }}</span>
                            </div>
                        </div>
                        <div class="d-flex gap-1 flex-shrink-0">
                            <button class="btn btn-sm btn-outline-primary" (click)="editSkill(skill)" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" (click)="deleteSkill(skill)" title="Delete">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p class="skill-notes text-secondary mt-2 mb-0 lh-sm small" *ngIf="skill.notes">{{ skill.notes }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommendations Section -->
    <div class="recommendations-section mt-5 px-3 px-md-4" *ngIf="showRecommendations">
        <div class="px-2 mb-4">
            <h3 class="mb-0">
                 Recommendations
            </h3>
        </div>

        <!-- Loading State -->
        <div class="text-center py-5" *ngIf="loadingRecommendations">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading recommendations...</span>
            </div>
            <p class="mt-3 text-muted">Loading personalized recommendations...</p>
        </div>

        <!-- Empty State -->
        <div class="text-center py-5" *ngIf="!loadingRecommendations && recommendations.length === 0">
            <i class="bi bi-inbox display-4 text-muted"></i>
            <p class="mt-3 text-muted">No recommendations available at the moment.</p>
        </div>

        <!-- Recommendations Grid -->
        <div class="recommendations-grid" *ngIf="!loadingRecommendations && recommendations.length > 0">
            <div class="recommendation-card bg-body rounded-3 overflow-hidden cursor-pointer d-flex flex-column" *ngFor="let rec of recommendations" (click)="openRecommendation(rec)">
                <div class="recommendation-thumbnail-container bg-secondary flex-shrink-0">
                    <img [src]="rec.thumbnailUrl" [alt]="rec.title">
                    <span class="recommendation-match-badge badge rounded-pill text-white border-0 d-flex align-items-center gap-1 fw-semibold small">
                        <i class="bi bi-stars"></i>
                        {{ rec.relevancePercentage }}% match
                    </span>
                </div>
                <div class="p-3 bg-body flex-fill d-flex flex-column">
                    <div class="d-flex gap-3 align-items-start">
                        <div class="recommendation-icon rounded-circle d-flex align-items-center justify-content-center text-white flex-shrink-0">
                            <i class="bi bi-lightbulb-fill"></i>
                        </div>
                        <div class="flex-fill" style="min-width: 0;">
                            <h3 class="card-title fw-semibold text-body mb-1 lh-sm small">{{ rec.title }}</h3>
                            <p class="text-secondary mb-1 fw-medium small" style="font-size: 0.85rem;">{{ rec.type }}</p>
                            <div class="d-flex align-items-center gap-2 flex-wrap text-muted" style="font-size: 0.8rem;">
                                <span class="badge bg-secondary">{{ rec.category }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Add Skill Modal -->
<div class="modal fade" [class.show]="showAddModal" [style.display]="showAddModal ? 'block' : 'none'" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-plus-circle"></i> Add New Skill
                </h5>
                <button type="button" class="btn-close" (click)="closeAddModal()"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Skill Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" [(ngModel)]="newSkill.skillName"
                        placeholder="e.g., Angular Development">
                </div>
                <div class="mb-3">
                    <label class="form-label">Category <span class="text-danger">*</span></label>
                    <app-account-type-selector [accountTypes]="categoryFormOptions"
                        [(ngModel)]="newSkill.category" (ngModelChange)="onCategorySelect($event)"
                        [label]="''" [placeholder]="loadingCategories ? 'Loading categories...' : 'Select Category'" id="newSkillCategory">
                    </app-account-type-selector>
                </div>
                <div class="mb-3">
                    <label class="form-label">Proficiency Level</label>
                    <app-account-type-selector [accountTypes]="proficiencyFormOptions"
                        [(ngModel)]="newSkill.proficiencyLevel" (ngModelChange)="onProficiencyLevelSelect($event)"
                        [label]="''" [placeholder]="'Select Level'" id="newSkillProficiency">
                    </app-account-type-selector>
                </div>
                <div class="mb-3">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea class="form-control" rows="3" [(ngModel)]="newSkill.notes"
                        placeholder="Add any additional notes..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="addSkill()">
                    <i class="bi bi-check-circle"></i> Add Skill
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade" [class.show]="showAddModal" *ngIf="showAddModal"></div>

<!-- Edit Skill Modal -->
<div class="modal fade" [class.show]="showEditModal" [style.display]="showEditModal ? 'block' : 'none'" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-pencil"></i> Edit Skill
                </h5>
                <button type="button" class="btn-close" (click)="closeEditModal()"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Skill Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" [(ngModel)]="newSkill.skillName">
                </div>
                <div class="mb-3">
                    <label class="form-label">Category <span class="text-danger">*</span></label>
                    <app-account-type-selector [accountTypes]="categoryFormOptions"
                        [(ngModel)]="newSkill.category" (ngModelChange)="onCategorySelect($event)"
                        [label]="''" [placeholder]="loadingCategories ? 'Loading categories...' : 'Select Category'" id="editSkillCategory">
                    </app-account-type-selector>
                </div>
                <div class="mb-3">
                    <label class="form-label">Proficiency Level</label>
                    <app-account-type-selector [accountTypes]="proficiencyFormOptions"
                        [(ngModel)]="newSkill.proficiencyLevel" (ngModelChange)="onProficiencyLevelSelect($event)"
                        [label]="''" [placeholder]="'Select Level'" id="editSkillProficiency">
                    </app-account-type-selector>
                </div>
                <div class="mb-3">
                    <label class="form-label">Notes (Optional)</label>
                    <textarea class="form-control" rows="3" [(ngModel)]="newSkill.notes"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
                <button type="button" class="btn btn-primary" (click)="updateSkill()">
                    <i class="bi bi-check-circle"></i> Update Skill
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal-backdrop fade" [class.show]="showEditModal" *ngIf="showEditModal"></div>