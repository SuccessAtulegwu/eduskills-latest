<div class="container-fluid p-0">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
    <div>
      <app-page-header title="Notifications" description="Stay updated with all your activities and alerts"></app-page-header>
    </div>
    <div class="d-flex gap-2">
      <app-button label="Mark All Read" icon="bi-check-all" variant="secondary" [outline]="true" (clicked)="markAllAsRead()"></app-button>
      <app-button label="Settings" icon="bi-gear" variant="primary" (clicked)="openSettings()"></app-button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-sm-6 col-lg-4">
      <div class="card h-100 border rounded-4 shadow-sm bg-body">
        <div class="card-body d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center rounded-3 bg-primary-subtle text-primary" style="width: 54px; height: 54px; flex-shrink: 0;">
            <i class="bi bi-bell fs-4"></i>
          </div>
          <div>
            <h4 class="fw-bold mb-0 text-body">{{ totalNotifications }}</h4>
            <p class="text-body small fw-medium mb-0">Total Notifications</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-4">
      <div class="card h-100 border rounded-4 shadow-sm bg-body">
        <div class="card-body d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center rounded-3 bg-warning-subtle text-warning" style="width: 54px; height: 54px; flex-shrink: 0;">
            <i class="bi bi-envelope fs-4"></i>
          </div>
          <div>
            <h4 class="fw-bold mb-0 text-body">{{ unreadNotifications }}</h4>
            <p class="text-body small fw-medium mb-0">Unread</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-4">
      <div class="card h-100 border rounded-4 shadow-sm bg-body">
        <div class="card-body d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center rounded-3 bg-success-subtle text-success" style="width: 54px; height: 54px; flex-shrink: 0;">
            <i class="bi bi-briefcase fs-4"></i>
          </div>
          <div>
            <h4 class="fw-bold mb-0 text-body">{{ jobAlerts }}</h4>
            <p class="text-body small fw-medium mb-0">Job Alerts</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="card border shadow-sm rounded-4 p-2 mb-4 bg-body">
    <div class="row g-3 mx-2 pt-2">
      <div class="col-lg-4 col-md-6">
        <app-input
          label="Search"
          placeholder="Search notifications..."
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange()">
        </app-input>
      </div>
      <div class="col-lg-4 col-md-6">
        <app-account-type-selector
          label="Type"
          placeholder="All Types"
          [accountTypes]="typeOptions"
          [(ngModel)]="selectedType"
          (ngModelChange)="onTypeChange()">
        </app-account-type-selector>
      </div>
      
    </div>
  </div>

  <!-- Desktop Table -->
  <div class="d-none d-lg-block">
    <div class="card border rounded-4 shadow-sm overflow-hidden bg-body">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="bg-body-tertiary">
            <tr class="text-body small fw-bold text-uppercase border-bottom">
              <th class="text-body ps-4 py-3" style="width: 50px;"></th>
              <th class="text-body py-3">Type</th>
              <th class="text-body py-3">Notification</th>
              <th class="text-body py-3">Priority</th>
              <th class="text-body py-3">Time</th>
              <th class="text-body pe-4 py-3 text-end">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let notification of filteredNotifications" 
                class="border-bottom" 
                [class.bg-body-tertiary]="!notification.read"
                style="cursor: pointer;" 
                (click)="navigateToNotification(notification)">
              <td class="ps-4 py-3">
                <span *ngIf="!notification.read" class="badge bg-primary rounded-circle" style="width: 8px; height: 8px;"></span>
              </td>
              <td>
                <span class="badge rounded-pill px-3 py-1 small border" [ngClass]="getTypeClass(notification.type)">
                  <i class="bi me-1" [ngClass]="getTypeIcon(notification.type)"></i>
                  {{ notification.type | titlecase }}
                </span>
              </td>
              <td>
                <h6 class="fw-bold mb-1 text-body" [class.fw-normal]="notification.read">{{ notification.title }}</h6>
                <p class="text-body-secondary small mb-0" style="display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;">
                  {{ notification.message }}
                </p>
              </td>
              <td>
                <span class="badge rounded-pill px-2 py-1 extra-small" [ngClass]="getPriorityClass(notification.priority)">
                  {{ notification.priority | titlecase }}
                </span>
              </td>
              <td>
                <div class="text-body small">
                  <div>{{ getTimeAgo(notification.createdAt) }}</div>
                  <div class="text-body-secondary extra-small">{{ notification.createdAt | date:'MMM dd, yyyy' }}</div>
                </div>
              </td>
              <td class="pe-4 text-end" (click)="$event.stopPropagation()">
                <div class="dropdown">
                  <button class="btn btn-sm text-body" type="button" data-bs-toggle="dropdown">
                    <i class="bi bi-three-dots-vertical"></i>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end shadow">
                    <li *ngIf="!notification.read">
                      <a class="dropdown-item py-2 text-body" (click)="markAsRead(notification)">
                        <i class="bi bi-check me-2 text-success"></i>Mark as Read
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item py-2 text-body text-danger" (click)="deleteNotification(notification, $event)">
                        <i class="bi bi-trash me-2"></i>Delete
                      </a>
                    </li>
                  </ul>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="filteredNotifications.length === 0" class="text-center py-5">
        <i class="bi bi-inbox fs-1 text-body-secondary opacity-50"></i>
        <h5 class="mt-3 fw-bold text-body">No Notifications Found</h5>
        <p class="text-body-secondary">Try adjusting your filters</p>
      </div>
    </div>
  </div>

  <!-- Mobile Cards -->
  <div class="d-lg-none">
    <div *ngFor="let notification of filteredNotifications" 
         class="card border rounded-4 shadow-sm mb-3 bg-body" 
         [class.bg-body-tertiary]="!notification.read"
         (click)="navigateToNotification(notification)">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div class="flex-grow-1">
            <div class="d-flex align-items-center gap-2 mb-1">
              <span *ngIf="!notification.read" class="badge bg-primary rounded-circle" style="width: 8px; height: 8px;"></span>
              <span class="badge rounded-pill px-2 py-1 extra-small border" [ngClass]="getTypeClass(notification.type)">
                <i class="bi me-1" [ngClass]="getTypeIcon(notification.type)"></i>
                {{ notification.type | titlecase }}
              </span>
              <span class="badge rounded-pill px-2 py-1 extra-small" [ngClass]="getPriorityClass(notification.priority)">
                {{ notification.priority | titlecase }}
              </span>
            </div>
            <h6 class="fw-bold mb-1 text-body" [class.fw-normal]="notification.read">{{ notification.title }}</h6>
          </div>
          <div class="dropdown" (click)="$event.stopPropagation()">
            <button class="btn btn-sm text-body" type="button" data-bs-toggle="dropdown">
              <i class="bi bi-three-dots-vertical"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow">
              <li *ngIf="!notification.read">
                <a class="dropdown-item py-2 text-body" (click)="markAsRead(notification)">
                  <i class="bi bi-check me-2 text-success"></i>Mark as Read
                </a>
              </li>
              <li>
                <a class="dropdown-item py-2 text-body text-danger" (click)="deleteNotification(notification, $event)">
                  <i class="bi bi-trash me-2"></i>Delete
                </a>
              </li>
            </ul>
          </div>
        </div>
        <p class="text-body-secondary small mb-2" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
          {{ notification.message }}
        </p>
        <div class="d-flex justify-content-between align-items-end pt-2 border-top border">
          <div>
            <div class="text-body extra-small mb-1">Time</div>
            <div class="text-body small fw-semibold">{{ getTimeAgo(notification.createdAt) }}</div>
          </div>
          <div class="text-end">
            <div class="text-body extra-small">{{ notification.createdAt | date:'MMM dd, yyyy' }}</div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="filteredNotifications.length === 0" class="text-center py-5">
      <i class="bi bi-inbox fs-1 text-body-secondary opacity-50"></i>
      <h5 class="mt-3 fw-bold text-body">No Notifications Found</h5>
      <p class="text-body-secondary">Try adjusting your filters</p>
    </div>
  </div>
</div>

<!-- Notification Settings Component -->
<app-notification-settings
  [showModal]="showSettings"
  (close)="closeSettings()">
</app-notification-settings>
