<div class="container-fluid p-0">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
    <div>
      <app-page-header title="Support Tickets" description="Manage and track your support requests"></app-page-header>
    </div>
    <app-button label="Create Ticket" icon="bi-plus-circle" variant="primary" (clicked)="openCreateModal()"></app-button>
  </div>

  <!-- Statistics Cards -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="card h-100 border rounded-4 shadow-sm bg-body">
        <div class="card-body d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center rounded-3 bg-primary-subtle text-primary" style="width: 54px; height: 54px; flex-shrink: 0;">
            <i class="bi bi-ticket-perforated fs-4"></i>
          </div>
          <div>
            <h4 class="fw-bold mb-0 text-body">{{ totalTickets }}</h4>
            <p class="text-body small fw-medium mb-0">Total Tickets</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="card h-100 border rounded-4 shadow-sm bg-body">
        <div class="card-body d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center rounded-3 bg-warning-subtle text-warning" style="width: 54px; height: 54px; flex-shrink: 0;">
            <i class="bi bi-circle fs-4"></i>
          </div>
          <div>
            <h4 class="fw-bold mb-0 text-body">{{ openTickets }}</h4>
            <p class="text-body small fw-medium mb-0">Open</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="card h-100 border rounded-4 shadow-sm bg-body">
        <div class="card-body d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center rounded-3 bg-info-subtle text-info" style="width: 54px; height: 54px; flex-shrink: 0;">
            <i class="bi bi-arrow-repeat fs-4"></i>
          </div>
          <div>
            <h4 class="fw-bold mb-0 text-body">{{ inProgressTickets }}</h4>
            <p class="text-body small fw-medium mb-0">In Progress</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-sm-6 col-lg-3">
      <div class="card h-100 border rounded-4 shadow-sm bg-body">
        <div class="card-body d-flex align-items-center gap-3">
          <div class="d-flex align-items-center justify-content-center rounded-3 bg-success-subtle text-success" style="width: 54px; height: 54px; flex-shrink: 0;">
            <i class="bi bi-check-circle-fill fs-4"></i>
          </div>
          <div>
            <h4 class="fw-bold mb-0 text-body">{{ resolvedTickets }}</h4>
            <p class="text-body small fw-medium mb-0">Resolved</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="card border shadow-sm rounded-4 p-2 mb-4 bg-body">
    <div class="row g-3 mx-2 pt-2">
      <div class="col-lg-3 col-md-6">
        <app-input
          label="Search"
          placeholder="Search tickets..."
          [(ngModel)]="searchQuery"
          (ngModelChange)="onSearchChange()">
        </app-input>
      </div>
      <div class="col-lg-3 col-md-6">
        <app-account-type-selector
          label="Status"
          placeholder="All Status"
          [accountTypes]="statusOptions"
          [(ngModel)]="selectedStatus"
          (ngModelChange)="onStatusChange()">
        </app-account-type-selector>
      </div>
      <div class="col-lg-3 col-md-6">
        <app-account-type-selector
          label="Category"
          placeholder="All Categories"
          [accountTypes]="categoryOptions"
          [(ngModel)]="selectedCategory"
          (ngModelChange)="onCategoryChange()">
        </app-account-type-selector>
      </div>
     
    </div>
  </div>

  <!-- Desktop Table -->
  <div class="d-none d-lg-block">
    <div class="card border rounded-4 shadow-sm overflow-hidden bg-body">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead class="bg-body-tertiary">
            <tr class="text-body small fw-bold text-uppercase border-bottom">
              <th class="text-body ps-4 py-3">Ticket #</th>
              <th class="text-body py-3">Subject</th>
              <th class="text-body py-3">Category</th>
              <th class="text-body py-3">Priority</th>
              <th class="text-body py-3">Status</th>
              <th class="text-body py-3">Created</th>
              <th class="text-body pe-4 py-3 text-end">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let ticket of filteredTickets" class="border-bottom" style="cursor: pointer;" (click)="viewTicket(ticket)">
              <td class="ps-4 py-3">
                <span class="text-body fw-semibold small">{{ ticket.ticketNumber }}</span>
              </td>
              <td>
                <h6 class="fw-bold mb-0 text-body">{{ ticket.subject }}</h6>
                <p class="text-body-secondary small mb-0" style="display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;">
                  {{ ticket.description }}
                </p>
              </td>
              <td>
                <span class="badge bg-body-tertiary text-body border rounded-pill px-3 py-1 small">
                  <i class="bi me-1" [ngClass]="getCategoryIcon(ticket.category)"></i>
                  {{ getCategoryText(ticket.category) }}
                </span>
              </td>
              <td>
                <span class="badge rounded-pill px-2 py-1 small" [ngClass]="getPriorityClass(ticket.priority)">
                  <i class="bi me-1" [ngClass]="getPriorityIcon(ticket.priority)"></i>
                  {{ ticket.priority | titlecase }}
                </span>
              </td>
              <td>
                <span class="badge rounded-pill px-3 py-1 fw-medium border small" [ngClass]="getStatusClass(ticket.status)">
                  <i class="bi me-1" [ngClass]="getStatusIcon(ticket.status)"></i>
                  {{ getStatusText(ticket.status) }}
                </span>
              </td>
              <td>
                <div class="text-body small">
                  <div>{{ ticket.createdAt | date:'MMM dd, yyyy' }}</div>
                  <div class="text-body-secondary extra-small">{{ getDaysSinceCreated(ticket.createdAt) }} days ago</div>
                </div>
              </td>
              <td class="pe-4 text-end" (click)="$event.stopPropagation()">
                <div class="dropdown">
                  <button class="btn btn-sm text-body" type="button" data-bs-toggle="dropdown">
                    <i class="bi bi-three-dots-vertical"></i>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end shadow">
                    <li><a class="dropdown-item py-2 text-body" (click)="viewTicket(ticket)"><i class="bi bi-eye me-2 text-primary"></i>View Details</a></li>
                  </ul>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="filteredTickets.length === 0" class="text-center py-5">
        <i class="bi bi-inbox fs-1 text-body-secondary opacity-50"></i>
        <h5 class="mt-3 fw-bold text-body">No Tickets Found</h5>
        <p class="text-body-secondary">Try adjusting your filters or create a new ticket</p>
      </div>
    </div>
  </div>

  <!-- Mobile Cards -->
  <div class="d-lg-none">
    <div *ngFor="let ticket of filteredTickets" class="card border rounded-4 shadow-sm mb-3 bg-body" (click)="viewTicket(ticket)">
      <div class="card-body p-3">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div class="flex-grow-1">
            <h6 class="fw-bold mb-1 text-body">{{ ticket.subject }}</h6>
            <span class="text-body-secondary extra-small">{{ ticket.ticketNumber }}</span>
          </div>
          <div class="dropdown" (click)="$event.stopPropagation()">
            <button class="btn btn-sm text-body" type="button" data-bs-toggle="dropdown">
              <i class="bi bi-three-dots-vertical"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow">
              <li><a class="dropdown-item py-2 text-body" (click)="viewTicket(ticket)"><i class="bi bi-eye me-2 text-primary"></i>View Details</a></li>
            </ul>
          </div>
        </div>
        <p class="text-body-secondary small mb-2" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
          {{ ticket.description }}
        </p>
        <div class="d-flex gap-2 flex-wrap mb-2">
          <span class="badge bg-body-tertiary text-body border rounded-pill px-2 py-1 extra-small">
            <i class="bi me-1" [ngClass]="getCategoryIcon(ticket.category)"></i>
            {{ getCategoryText(ticket.category) }}
          </span>
          <span class="badge rounded-pill px-2 py-1 extra-small" [ngClass]="getPriorityClass(ticket.priority)">
            <i class="bi me-1" [ngClass]="getPriorityIcon(ticket.priority)"></i>
            {{ ticket.priority | titlecase }}
          </span>
          <span class="badge rounded-pill border px-2 py-1 fw-medium extra-small" [ngClass]="getStatusClass(ticket.status)">
            <i class="bi me-1" [ngClass]="getStatusIcon(ticket.status)"></i>
            {{ getStatusText(ticket.status) }}
          </span>
        </div>
        <div class="d-flex justify-content-between align-items-end pt-2 border-top border">
          <div>
            <div class="text-body extra-small mb-1">Created</div>
            <div class="text-body small fw-semibold">{{ ticket.createdAt | date:'MMM dd, yyyy' }}</div>
          </div>
          <div class="text-end">
            <div class="text-body extra-small">{{ getDaysSinceCreated(ticket.createdAt) }} days ago</div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="filteredTickets.length === 0" class="text-center py-5">
      <i class="bi bi-inbox fs-1 text-body-secondary opacity-50"></i>
      <h5 class="mt-3 fw-bold text-body">No Tickets Found</h5>
      <p class="text-body-secondary">Try adjusting your filters or create a new ticket</p>
    </div>
  </div>
</div>

<!-- Ticket Details Component -->
<app-support-ticket-details
  [ticket]="selectedTicket"
  [showModal]="showDetailsModal"
  (close)="closeDetailsModal()">
</app-support-ticket-details>

<!-- Create Ticket Component -->
<app-create-support-ticket
  [showModal]="showCreateModal"
  (close)="closeCreateModal()"
  (ticketCreated)="onTicketCreated()">
</app-create-support-ticket>

